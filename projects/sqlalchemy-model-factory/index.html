<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
      <meta name="author" content="Dan Cardin">
    
    
    

    <title>
    SQLAlchemy Model Factory
</title>

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css">
    <script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <link rel="stylesheet" href="https://dancardin.github.io/style.css">

    
  </head>

  <body class="colorscheme-light">
    <main class="wrapper">
      
  <nav class="navigation">
    <section class="container">
      <a class="navigation-title" href="https:&#x2F;&#x2F;dancardin.github.io">
        Dan Cardin
      </a>
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fas fa-bars"></i>
      </label>
      <ul class="navigation-list">
        
          <li class="navigation-item">
              <a class="navigation-link" href="https://dancardin.github.io/projects">Projects</a>
          </li>
        
          <li class="navigation-item">
              <a class="navigation-link" href="https://dancardin.github.io/content">Content</a>
          </li>
        

        
      </ul>
    </section>
  </nav>


      <div class="content">
        
  <section class="container page">
    <article>
      <header>
        
  
  

  <h1>
    <a href="https://github.com/dancardin&#x2F;sqlalchemy-model-factory">SQLAlchemy Model Factory</a>
    <img src="https:&#x2F;&#x2F;avatars.githubusercontent.com&#x2F;u&#x2F;701548?v=4" width="25", height="25">
  </h1>

  Makes it easy to write factory functions for sqlalchemy models, particularly for use in testing.
  <hr/>

      </header>

      

      
  

  
  

  <p><a href="https://github.com/dancardin/sqlalchemy-model-factory/actions"><img src="https://github.com/dancardin/sqlalchemy-model-factory/workflows/build/badge.svg" alt="Actions Status" /></a> <a href="https://codecov.io/gh/DanCardin/sqlalchemy-model-factory"><img src="https://codecov.io/gh/DanCardin/sqlalchemy-model-factory/branch/master/graph/badge.svg" alt="codecov" /></a> <a href="https://sqlalchemy-model-factory.readthedocs.io/en/latest/?badge=latest"><img src="https://readthedocs.org/projects/sqlalchemy-model-factory/badge/?version=latest" alt="Documentation Status" /></a></p>
<p>sqlalchemy-model-factory aims to make it easy to write factory functions for sqlalchemy
models, particularly for use in testing.</p>
<p>It should make it easy to define as many factories as you might want, with as little
boilerplate as possible, while remaining as unopinionated as possible about the behavior
going in your factories.</p>
<h2 id="installation">Installation</h2>
<pre data-lang="python" class="language-python "><code class="language-python" data-lang="python">pip install sqlalchemy-model-factory
</code></pre>
<h2 id="usage">Usage</h2>
<p>Suppose you've defined a <code>Widget</code> model, and for example you want to test some API code
that queries for <code>Widget</code> instances. Couple of factory functions might look like so:</p>
<pre data-lang="python" class="language-python "><code class="language-python" data-lang="python"># tests/test_example_which_uses_pytest
from sqlalchemy_model_factory import autoincrement, register_at
from . import models

@register_at('widget')
def new_widget(name, weight, color, size, **etc):
    """My goal is to allow you to specify *all* the options a widget might require.
    """
    return Widget(name, weight, color, size, **etc)

@register_at('widget', name='default')
@autoincrement
def new_default_widget(autoincrement=1):
    """My goal is to give you a widget with as little input as possible.
    """
    # I'm gonna call the other factory function...because i can!
    return new_widget(
        f'default_name{autoincrement}',
        weight=autoincrement,
        color='rgb({0}, {0}, {0})'.format(autoincrement),
        size=autoincrement,
    )
</code></pre>
<p>What this does, is register those functions to the registry of factory functions, within
the &quot;widget&quot; namespace, at the <code>name</code> (defaults to <code>new</code>) location in the namespace.</p>
<p>So when I go to write a test, all I need to do is accept the <code>mf</code> fixture (and lets say
a <code>session</code> db connection fixture to make assertions against) and I can call all the
factories that have been registered.</p>
<pre data-lang="python" class="language-python "><code class="language-python" data-lang="python">def test_example_model(mf, session):
    widget1 = mf.widget.new('name', 1, 'rgb(0, 0, 0)', 1)
    widget2 = mf.widget.default()
    widget3 = mf.widget.default()
    widget4 = mf.widget.default()

    widgets = session.query(Widget).all()
    assert len(widgets) == 4
    assert widgets[0].name == 'name'
    assert widgets[1].id == widget2.id
    assert widgets[2].name == widget3.name
    assert widgets[3].color == 'rgb(3, 3, 3)'
</code></pre>
<p>In a simple toy example, where you don't gain much on the calls themselves the benefits
are primarily:</p>
<ul>
<li>The instances are automatically put into the database and cleaned up after the test.</li>
<li>You can make assertions without hardcoding the values, because you get back a handle on the object.</li>
</ul>
<p>But as the graph of models required to set up a particular scenario grows:</p>
<ul>
<li>You can define factories as complex as you want
<ul>
<li>They can create related objects and assign them to relationships</li>
<li>They can be given sources of randomness or uniqueness to not violate constraints</li>
<li>They can compose with eachother (when called normally, they're the same as the original function).</li>
</ul>
</li>
</ul>


    </article>
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
        Â© 2020
        
          Dan Cardin
        
      
    </section>
  </footer>

    </main>
  </body>
</html>
