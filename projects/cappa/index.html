<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Cappa | Dan Cardin</title>
<meta name=keywords content><meta name=description content='Cappa Full documentation here. Comparison vs existing libraries.. Annotation inference details &ldquo;invoke&rdquo; (click-like) details Cappa is a declarative command line parsing library, taking much of its inspiration from the &ldquo;Derive&rdquo; API from the Clap written in Rust.
from dataclasses import dataclass, field import cappa from typing import Literal from typing_extensions import Annotated @dataclass class Example: positional_arg: str = "optional" boolean_flag: bool = False single_option: Annotated[int | None, cappa.Arg(short=True, help="A number")] = None multiple_option: Annotated[ list[Literal["one", "two", "three"]], cappa.'><meta name=author content="Dan Cardin"><link rel=canonical href=https://dancardin.github.io/projects/cappa/><link crossorigin=anonymous href=/assets/css/stylesheet.c7f09cbdd6e090b6a2383553f3c42c749f3ea74dc0c82908d4f9b489b5c80c56.css integrity="sha256-x/CcvdbgkLaiODVT88QsdJ8+p03AyCkI1Pm0ibXIDFY=" rel="preload stylesheet" as=style><link rel=icon href=https://dancardin.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dancardin.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dancardin.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://dancardin.github.io/apple-touch-icon.png><link rel=mask-icon href=https://dancardin.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://dancardin.github.io/projects/cappa/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Cappa"><meta property="og:description" content='Cappa Full documentation here. Comparison vs existing libraries.. Annotation inference details &ldquo;invoke&rdquo; (click-like) details Cappa is a declarative command line parsing library, taking much of its inspiration from the &ldquo;Derive&rdquo; API from the Clap written in Rust.
from dataclasses import dataclass, field import cappa from typing import Literal from typing_extensions import Annotated @dataclass class Example: positional_arg: str = "optional" boolean_flag: bool = False single_option: Annotated[int | None, cappa.Arg(short=True, help="A number")] = None multiple_option: Annotated[ list[Literal["one", "two", "three"]], cappa.'><meta property="og:type" content="article"><meta property="og:url" content="https://dancardin.github.io/projects/cappa/"><meta property="article:section" content="projects"><meta property="article:published_time" content="2023-09-23T00:00:00+00:00"><meta property="article:modified_time" content="2023-09-23T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Cappa"><meta name=twitter:description content='Cappa Full documentation here. Comparison vs existing libraries.. Annotation inference details &ldquo;invoke&rdquo; (click-like) details Cappa is a declarative command line parsing library, taking much of its inspiration from the &ldquo;Derive&rdquo; API from the Clap written in Rust.
from dataclasses import dataclass, field import cappa from typing import Literal from typing_extensions import Annotated @dataclass class Example: positional_arg: str = "optional" boolean_flag: bool = False single_option: Annotated[int | None, cappa.Arg(short=True, help="A number")] = None multiple_option: Annotated[ list[Literal["one", "two", "three"]], cappa.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Projects","item":"https://dancardin.github.io/projects/"},{"@type":"ListItem","position":2,"name":"Cappa","item":"https://dancardin.github.io/projects/cappa/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Cappa","name":"Cappa","description":"Cappa Full documentation here. Comparison vs existing libraries.. Annotation inference details \u0026ldquo;invoke\u0026rdquo; (click-like) details Cappa is a declarative command line parsing library, taking much of its inspiration from the \u0026ldquo;Derive\u0026rdquo; API from the Clap written in Rust.\nfrom dataclasses import dataclass, field import cappa from typing import Literal from typing_extensions import Annotated @dataclass class Example: positional_arg: str = \u0026#34;optional\u0026#34; boolean_flag: bool = False single_option: Annotated[int | None, cappa.Arg(short=True, help=\u0026#34;A number\u0026#34;)] = None multiple_option: Annotated[ list[Literal[\u0026#34;one\u0026#34;, \u0026#34;two\u0026#34;, \u0026#34;three\u0026#34;]], cappa.","keywords":[],"articleBody":"Cappa Full documentation here. Comparison vs existing libraries.. Annotation inference details “invoke” (click-like) details Cappa is a declarative command line parsing library, taking much of its inspiration from the “Derive” API from the Clap written in Rust.\nfrom dataclasses import dataclass, field import cappa from typing import Literal from typing_extensions import Annotated @dataclass class Example: positional_arg: str = \"optional\" boolean_flag: bool = False single_option: Annotated[int | None, cappa.Arg(short=True, help=\"A number\")] = None multiple_option: Annotated[ list[Literal[\"one\", \"two\", \"three\"]], cappa.Arg(long=True, help=\"Pick one!\"), ] = field(default_factory=list) args: Example = cappa.parse(Example, backend=cappa.backend) print(args) Produces the following CLI:\nIn this way, you can turn any dataclass-like object (with some additional annotations, depending on what you’re looking for) into a CLI.\nYou’ll note that cappa.parse returns an instance of the class. This API should feel very familiar to argparse, except that you get the fully typed dataclass instance back instead of a raw Namespace.\nInvoke “invoke” documentation\nThe “invoke” API is meant to feel more like the experience you get when using click or typer. You can take the same dataclass, but register a function to be called on successful parsing of the command.\nfrom dataclasses import dataclass import cappa from typing_extensions import Annotated def function(example: Example): print(example) @cappa.command(invoke=function) class Example: # identical to original class positional_arg: str boolean_flag: bool single_option: Annotated[int | None, cappa.Arg(long=True)] multiple_option: Annotated[list[str], cappa.Arg(short=True)] cappa.invoke(Example) (Note the lack of the dataclass decorator. You can optionally omit or include it, and it will be automatically inferred).\nAlternatively you can make your dataclass callable, as a shorthand for an explicit invoke function:\n@dataclass class Example: ... # identical to original class def __call__(self): print(self) Note invoke=function can either be a reference to some callable, or a string module-reference to a function (which will get lazily imported and invoked).\nWith a single top-level command, the click-like API isn’t particularly valuable by comparison. Click’s command-centric API is primarily useful when composing a number of nested subcommands.\nSubcommands The useful aspect of click’s functional composability is that you can define some number of subcommands functions under a parent command, whichever subcommand the function targets will be invoked.\nimport click @click.group('example') def example(): ... @example.command(\"print\") @click.option('--loudly', is_flag=True) def print_cmd(loudly): if loudly: print(\"PRINTING!\") else: print(\"printing!\") @example.command(\"fail\") @click.option('--code', type: int) def fail_cmd(code): raise click.Exit(code=code) # Called like: # /example.py print # /example.py fail Whereas with argparse, you’d have had to manually match and call the functions yourself. This API does all of the hard parts of deciding which function to call.\nSimilarly, you can achieve the same thing with cappa.\nfrom __future__ import annotations from dataclasses import dataclass import cappa @dataclass class Example: cmd: cappa.Subcommands[Print | Fail] def print_cmd(print: Print): if print.loudly: print(\"PRINTING!\") else: print(\"printing!\") @cappa.command(invoke=print_cmd) class Print: loudly: bool @dataclass class Fail: code: int def __call__(self): # again, __call__ is shorthand for the above explicit `invoke=` form. raise cappa.Exit(code=code) cappa.invoke(Example) Function-based Commands Purely functions-based can only be used for certain kinds of CLI interfaces. However, they can reduce the ceremony required to define a given CLI command.\nimport cappa from typing_extensions import Annotated def function(foo: int, bar: bool, option: Annotated[str, cappa.Arg(long=True)] = \"opt\"): ... cappa.invoke(function) Such a CLI is exactly equivalent to a CLI defined as a dataclass with the function’s arguments as the dataclass’s fields.\nThere are various downsides to using functions. Given that there is no class to reference, any feature which relies on being able to name the type will be impossible to use. For example, subcommands cannot be naturally defined as functions (since there is no type with which to reference the subcommand).\n","wordCount":"588","inLanguage":"en","datePublished":"2023-09-23T00:00:00Z","dateModified":"2023-09-23T00:00:00Z","author":{"@type":"Person","name":"Dan Cardin"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dancardin.github.io/projects/cappa/"},"publisher":{"@type":"Organization","name":"Dan Cardin","logo":{"@type":"ImageObject","url":"https://dancardin.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dancardin.github.io/ accesskey=h title="Dan Cardin (Alt + H)">Dan Cardin</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://dancardin.github.io/projects title=Projects><span>Projects</span></a></li><li><a href=https://dancardin.github.io/wats title=Wats><span>Wats</span></a></li><li><a href=https://dancardin.github.io/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dancardin.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://dancardin.github.io/projects/>Projects</a></div><h1 class=post-title>Cappa</h1><div class=post-meta><a href=https://github.com/DanCardin/cappa target=_blank rel="noopener noreferrer me"><svg width="32" height="32" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg></a></div></header><div class=post-content><h1 id=cappa>Cappa<a hidden class=anchor aria-hidden=true href=#cappa>#</a></h1><p><a href=https://github.com/dancardin/cappa/actions><img loading=lazy src=https://github.com/DanCardin/cappa/actions/workflows/test.yml/badge.svg alt="Actions Status">
</a><a href="https://coveralls.io/github/DanCardin/cappa?branch=main"><img loading=lazy src="https://coveralls.io/repos/github/DanCardin/cappa/badge.svg?branch=main" alt="Coverage Status">
</a><a href="https://cappa.readthedocs.io/en/latest/?badge=latest"><img loading=lazy src="https://readthedocs.org/projects/cappa/badge/?version=latest" alt="Documentation Status"></a></p><ul><li><a href=https://cappa.readthedocs.io/en/latest/>Full documentation here</a>.</li><li><a href=https://cappa.readthedocs.io/en/latest/comparison.html>Comparison vs existing libraries.</a>.</li><li><a href=https://cappa.readthedocs.io/en/latest/annotation.html>Annotation inference details</a></li><li><a href=https://cappa.readthedocs.io/en/latest/invoke.html>&ldquo;invoke&rdquo; (click-like) details</a></li></ul><p>Cappa is a declarative command line parsing library, taking much of its
inspiration from the &ldquo;Derive&rdquo; API from the
<a href=https://docs.rs/clap/latest/clap/_derive/index.html>Clap</a> written in Rust.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span><span class=p>,</span> <span class=n>field</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>cappa</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Literal</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing_extensions</span> <span class=kn>import</span> <span class=n>Annotated</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Example</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>positional_arg</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;optional&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>boolean_flag</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=n>single_option</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=nb>int</span> <span class=o>|</span> <span class=kc>None</span><span class=p>,</span> <span class=n>cappa</span><span class=o>.</span><span class=n>Arg</span><span class=p>(</span><span class=n>short</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s2>&#34;A number&#34;</span><span class=p>)]</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>multiple_option</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=nb>list</span><span class=p>[</span><span class=n>Literal</span><span class=p>[</span><span class=s2>&#34;one&#34;</span><span class=p>,</span> <span class=s2>&#34;two&#34;</span><span class=p>,</span> <span class=s2>&#34;three&#34;</span><span class=p>]],</span>
</span></span><span class=line><span class=cl>        <span class=n>cappa</span><span class=o>.</span><span class=n>Arg</span><span class=p>(</span><span class=n>long</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s2>&#34;Pick one!&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span> <span class=o>=</span> <span class=n>field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>args</span><span class=p>:</span> <span class=n>Example</span> <span class=o>=</span> <span class=n>cappa</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>Example</span><span class=p>,</span> <span class=n>backend</span><span class=o>=</span><span class=n>cappa</span><span class=o>.</span><span class=n>backend</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>args</span><span class=p>)</span>
</span></span></code></pre></div><p>Produces the following CLI:</p><p><img loading=lazy src=./docs/source/_static/example.svg alt="help text"></p><p>In this way, you can turn any dataclass-like object (with some additional
annotations, depending on what you&rsquo;re looking for) into a CLI.</p><p>You&rsquo;ll note that <code>cappa.parse</code> returns an instance of the class. This API should
feel very familiar to <code>argparse</code>, except that you get the fully typed dataclass
instance back instead of a raw <code>Namespace</code>.</p><h2 id=invoke>Invoke<a hidden class=anchor aria-hidden=true href=#invoke>#</a></h2><p><a href=https://cappa.readthedocs.io/en/latest/invoke.html>&ldquo;invoke&rdquo; documentation</a></p><p>The &ldquo;invoke&rdquo; API is meant to feel more like the experience you get when using
<code>click</code> or <code>typer</code>. You can take the same dataclass, but register a function to
be called on successful parsing of the command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>cappa</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing_extensions</span> <span class=kn>import</span> <span class=n>Annotated</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>function</span><span class=p>(</span><span class=n>example</span><span class=p>:</span> <span class=n>Example</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>example</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@cappa.command</span><span class=p>(</span><span class=n>invoke</span><span class=o>=</span><span class=n>function</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Example</span><span class=p>:</span>  <span class=c1># identical to original class</span>
</span></span><span class=line><span class=cl>    <span class=n>positional_arg</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>boolean_flag</span><span class=p>:</span> <span class=nb>bool</span>
</span></span><span class=line><span class=cl>    <span class=n>single_option</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=nb>int</span> <span class=o>|</span> <span class=kc>None</span><span class=p>,</span> <span class=n>cappa</span><span class=o>.</span><span class=n>Arg</span><span class=p>(</span><span class=n>long</span><span class=o>=</span><span class=kc>True</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>multiple_option</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>cappa</span><span class=o>.</span><span class=n>Arg</span><span class=p>(</span><span class=n>short</span><span class=o>=</span><span class=kc>True</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cappa</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>Example</span><span class=p>)</span>
</span></span></code></pre></div><p>(Note the lack of the dataclass decorator. You can optionally omit or include
it, and it will be automatically inferred).</p><p>Alternatively you can make your dataclass callable, as a shorthand for an
explicit invoke function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Example</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>   <span class=c1># identical to original class</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__call__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>       <span class=nb>print</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span></code></pre></div><p>Note <code>invoke=function</code> can either be a reference to some callable, or a string
module-reference to a function (which will get lazily imported and invoked).</p><p>With a single top-level command, the click-like API isn&rsquo;t particularly valuable
by comparison. Click&rsquo;s command-centric API is primarily useful when composing a
number of nested subcommands.</p><h2 id=subcommands>Subcommands<a hidden class=anchor aria-hidden=true href=#subcommands>#</a></h2><p>The useful aspect of click&rsquo;s functional composability is that you can define
some number of subcommands functions under a parent command, whichever
subcommand the function targets will be invoked.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>click</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@click.group</span><span class=p>(</span><span class=s1>&#39;example&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>example</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@example.command</span><span class=p>(</span><span class=s2>&#34;print&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nd>@click.option</span><span class=p>(</span><span class=s1>&#39;--loudly&#39;</span><span class=p>,</span> <span class=n>is_flag</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>print_cmd</span><span class=p>(</span><span class=n>loudly</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>loudly</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;PRINTING!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;printing!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@example.command</span><span class=p>(</span><span class=s2>&#34;fail&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nd>@click.option</span><span class=p>(</span><span class=s1>&#39;--code&#39;</span><span class=p>,</span> <span class=nb>type</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>fail_cmd</span><span class=p>(</span><span class=n>code</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>raise</span> <span class=n>click</span><span class=o>.</span><span class=n>Exit</span><span class=p>(</span><span class=n>code</span><span class=o>=</span><span class=n>code</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Called like:</span>
</span></span><span class=line><span class=cl><span class=c1># /example.py print</span>
</span></span><span class=line><span class=cl><span class=c1># /example.py fail</span>
</span></span></code></pre></div><p>Whereas with argparse, you&rsquo;d have had to manually match and call the functions
yourself. This API does all of the hard parts of deciding which function to
call.</p><p>Similarly, you can achieve the same thing with cappa.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>__future__</span> <span class=kn>import</span> <span class=n>annotations</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>cappa</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Example</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>cmd</span><span class=p>:</span> <span class=n>cappa</span><span class=o>.</span><span class=n>Subcommands</span><span class=p>[</span><span class=n>Print</span> <span class=o>|</span> <span class=n>Fail</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>print_cmd</span><span class=p>(</span><span class=nb>print</span><span class=p>:</span> <span class=n>Print</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>print</span><span class=o>.</span><span class=n>loudly</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;PRINTING!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;printing!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@cappa.command</span><span class=p>(</span><span class=n>invoke</span><span class=o>=</span><span class=n>print_cmd</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Print</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>loudly</span><span class=p>:</span> <span class=nb>bool</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dataclass</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Fail</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>code</span><span class=p>:</span> <span class=nb>int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__call__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  <span class=c1># again, __call__ is shorthand for the above explicit `invoke=` form.</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=n>cappa</span><span class=o>.</span><span class=n>Exit</span><span class=p>(</span><span class=n>code</span><span class=o>=</span><span class=n>code</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cappa</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>Example</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=function-based-commands>Function-based Commands<a hidden class=anchor aria-hidden=true href=#function-based-commands>#</a></h2><p>Purely functions-based can only be used for certain kinds of CLI interfaces.
However, they <strong>can</strong> reduce the ceremony required to define a given CLI
command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>cappa</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing_extensions</span> <span class=kn>import</span> <span class=n>Annotated</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>function</span><span class=p>(</span><span class=n>foo</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>bar</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span> <span class=n>option</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>cappa</span><span class=o>.</span><span class=n>Arg</span><span class=p>(</span><span class=n>long</span><span class=o>=</span><span class=kc>True</span><span class=p>)]</span> <span class=o>=</span> <span class=s2>&#34;opt&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cappa</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span><span class=n>function</span><span class=p>)</span>
</span></span></code></pre></div><p>Such a CLI is exactly equivalent to a CLI defined as a dataclass with the
function&rsquo;s arguments as the dataclass&rsquo;s fields.</p><p>There are various downsides to using functions. Given that there is no class to
reference, any feature which relies on being able to name the type will be
impossible to use. For example, subcommands cannot be naturally defined as
functions (since there is no type with which to reference the subcommand).</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>