<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Python Formatting | Dan Cardin</title>
<meta name=keywords content="python,wat"><meta name=description content=">>> a = {'a': {'b': 4}}

>>> '{a[&#34;a&#34;][&#34;b&#34;]}'.format(a=asdf)
*** KeyError: '&#34;a&#34;'

>>>'{a[a][b]}'.format(a=asdf)
'4'
"><meta name=author content="Dan Cardin"><link rel=canonical href=https://dancardin.github.io/wats/python-formatting/><link crossorigin=anonymous href=/assets/css/stylesheet.c7f09cbdd6e090b6a2383553f3c42c749f3ea74dc0c82908d4f9b489b5c80c56.css integrity="sha256-x/CcvdbgkLaiODVT88QsdJ8+p03AyCkI1Pm0ibXIDFY=" rel="preload stylesheet" as=style><link rel=icon href=https://dancardin.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dancardin.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dancardin.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://dancardin.github.io/apple-touch-icon.png><link rel=mask-icon href=https://dancardin.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://dancardin.github.io/wats/python-formatting/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Python Formatting"><meta property="og:description" content=">>> a = {'a': {'b': 4}}

>>> '{a[&#34;a&#34;][&#34;b&#34;]}'.format(a=asdf)
*** KeyError: '&#34;a&#34;'

>>>'{a[a][b]}'.format(a=asdf)
'4'
"><meta property="og:type" content="article"><meta property="og:url" content="https://dancardin.github.io/wats/python-formatting/"><meta property="article:section" content="wats"><meta property="article:published_time" content="2021-12-01T09:05:32-05:00"><meta property="article:modified_time" content="2021-12-01T09:05:32-05:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Python Formatting"><meta name=twitter:description content=">>> a = {'a': {'b': 4}}

>>> '{a[&#34;a&#34;][&#34;b&#34;]}'.format(a=asdf)
*** KeyError: '&#34;a&#34;'

>>>'{a[a][b]}'.format(a=asdf)
'4'
"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Wats","item":"https://dancardin.github.io/wats/"},{"@type":"ListItem","position":2,"name":"Python Formatting","item":"https://dancardin.github.io/wats/python-formatting/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Python Formatting","name":"Python Formatting","description":"\u0026gt;\u0026gt;\u0026gt; a = {\u0026#39;a\u0026#39;: {\u0026#39;b\u0026#39;: 4}} \u0026gt;\u0026gt;\u0026gt; \u0026#39;{a[\u0026#34;a\u0026#34;][\u0026#34;b\u0026#34;]}\u0026#39;.format(a=asdf) *** KeyError: \u0026#39;\u0026#34;a\u0026#34;\u0026#39; \u0026gt;\u0026gt;\u0026gt;\u0026#39;{a[a][b]}\u0026#39;.format(a=asdf) \u0026#39;4\u0026#39; ","keywords":["python","wat"],"articleBody":"\u003e\u003e\u003e a = {'a': {'b': 4}} \u003e\u003e\u003e '{a[\"a\"][\"b\"]}'.format(a=asdf) *** KeyError: '\"a\"' \u003e\u003e\u003e'{a[a][b]}'.format(a=asdf) '4' Wat.\nIt turns out this is documented briefly in PEP-498, although apparently not at all in the official docs.\nThere is one small difference between the limited expressions allowed in str.format() and the full expressions allowed inside f-strings. The difference is in how index lookups are performed. In str.format(), index values that do not look like numbers are converted to strings\nEssentially it boils down to the fact that fstrings take advantage of python’s actual parser, and therefore have syntax consistent with the rest of the language, whereas str.format is approximating regular python syntax by reimplementing some common access patterns in a mini lookalike-dsl.\nAnd indeed if you attempt the same thing with an fstring:\n\u003e\u003e\u003e f'{a[\"a\"][\"b\"]}' *** '4' While some people may look at that and find the behavior unsurprising, I personally think it looks like an unfortunate footgun that one would be forgiven to think had different semantics than it has.\nI can see what they were probably thinking at the time:\nThere’s going to be some additional complexity in parsing the extra syntax to support a[\"a\"] What would a[b] even mean? Presumably b would have to be some additional str.format argument? (It gets a bit weird because it’s not capturing local variables like fstrings do). Given the above, why force the user to type quotes all the time? My hot take is that it’s fine for str.format to not attempt to support arbitrary python syntax, but that what it does support should have identical semantics. I.e. I should be able to copy that portion of the format string out of the string and it should behave the same.\n","wordCount":"284","inLanguage":"en","datePublished":"2021-12-01T09:05:32-05:00","dateModified":"2021-12-01T09:05:32-05:00","author":{"@type":"Person","name":"Dan Cardin"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dancardin.github.io/wats/python-formatting/"},"publisher":{"@type":"Organization","name":"Dan Cardin","logo":{"@type":"ImageObject","url":"https://dancardin.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dancardin.github.io/ accesskey=h title="Dan Cardin (Alt + H)">Dan Cardin</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://dancardin.github.io/projects title=Projects><span>Projects</span></a></li><li><a href=https://dancardin.github.io/wats title=Wats><span>Wats</span></a></li><li><a href=https://dancardin.github.io/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dancardin.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://dancardin.github.io/wats/>Wats</a></div><h1 class=post-title>Python Formatting</h1><div class=post-meta>&lt;span title='2021-12-01 09:05:32 -0500 -0500'>December 1, 2021&lt;/span>&amp;nbsp;·&amp;nbsp;2 min&amp;nbsp;·&amp;nbsp;Dan Cardin</div></header><div class=post-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>a</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=mi>4</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=s1>&#39;</span><span class=si>{a[&#34;a&#34;][&#34;b&#34;]}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>a</span><span class=o>=</span><span class=n>asdf</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>***</span> <span class=ne>KeyError</span><span class=p>:</span> <span class=s1>&#39;&#34;a&#34;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span><span class=s1>&#39;</span><span class=si>{a[a][b]}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>a</span><span class=o>=</span><span class=n>asdf</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;4&#39;</span>
</span></span></code></pre></div><p>Wat.</p><p>It turns out this is documented briefly in <a href=https://peps.python.org/pep-0498/#differences-between-f-string-and-str-format-expressions>PEP-498</a>,
although apparently not at all in the <a href=https://docs.python.org/3/library/string.html#format-string-syntax>official docs</a>.</p><blockquote><p>There is one small difference between the limited expressions allowed in str.format()
and the full expressions allowed inside f-strings. The difference is in how index
lookups are performed. In str.format(), index values that do not look like numbers
are converted to strings</p></blockquote><p>Essentially it boils down to the fact that fstrings take advantage of python&rsquo;s actual
parser, and therefore have syntax consistent with the rest of the language, whereas
<code>str.format</code> is approximating regular python syntax by reimplementing some common
access patterns in a mini lookalike-dsl.</p><p>And indeed if you attempt the same thing with an fstring:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>a</span><span class=p>[</span><span class=s2>&#34;a&#34;</span><span class=p>][</span><span class=s2>&#34;b&#34;</span><span class=p>]</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=o>***</span> <span class=s1>&#39;4&#39;</span>
</span></span></code></pre></div><p>While some people may look at that and find the behavior unsurprising, I personally
think it looks like an unfortunate footgun that one would be forgiven to think
had different semantics than it has.</p><p>I can see what they were probably thinking at the time:</p><ul><li>There&rsquo;s going to be some additional complexity in parsing the extra syntax to support <code>a["a"]</code></li><li>What would <code>a[b]</code> even mean? Presumably <code>b</code> would have to be some additional <code>str.format</code>
argument? (It gets a bit weird because it&rsquo;s not capturing local variables like fstrings do).</li><li>Given the above, why force the user to type quotes all the time?</li></ul><p>My hot take is that it&rsquo;s fine for <code>str.format</code> to not attempt to support arbitrary python syntax,
but that what it <strong>does</strong> support should have identical semantics. I.e. I should be able to copy
that portion of the format string out of the string and it should behave the same.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://dancardin.github.io/tags/python/>Python</a></li><li><a href=https://dancardin.github.io/tags/wat/>Wat</a></li></ul></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>